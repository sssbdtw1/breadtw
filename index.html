<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>é¹¿æ¸¯è€è¡—çš„æ•…äº‹åº§æ¨™ï¼šåœ°åœ–èªªæ›¸äºº</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* CSS æ¨£å¼ï¼šè¨­å®šåœ°åœ–é¡¯ç¤ºå€å¡Šçš„å¤§å° */
        #map {
            height: 100vh; /* è®“åœ°åœ–ä½”æ»¿æ•´å€‹è¦–çª—é«˜åº¦ */
            width: 100%;  /* è®“åœ°åœ–ä½”æ»¿æ•´å€‹è¦–çª—å¯¬åº¦ */
        }
        /* è³‡è¨Šè¦–çª—çš„æ¨£å¼èª¿æ•´ï¼Œè®“æ•…äº‹å…§å®¹æ›´æ˜“è®€ */
        .info-window-content {
            max-width: 400px;
            padding: 5px;
        }
        .info-window-content h4 {
            font-size: 20px;
			margin-top: 0;
            color: #C0392B; /* é¹¿æ¸¯ç´… */
        }
        .info-window-content p {
            font-size: 18px;
            line-height: 1.5;
        }
        /* è®“é é¢é‚Šè·æ­¸é›¶ */
        body {
            margin: 0;
            padding: 0;
        }
        /* ç¯©é¸é¸å–®çš„æ¨£å¼ï¼Œè®“å®ƒæµ®åœ¨åœ°åœ–ä¸Šæ–¹ */
        #filter-container {
            position: absolute;
            top: 60px;
            left: 10px;
            z-index: 10; /* ç¢ºä¿é¸å–®åœ¨åœ°åœ–ä¹‹ä¸Š */
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 6px rgba(0,0,0,.3);
            font-family: Arial, sans-serif;
            font-size: 15px;
        }
        #category-filter {
            padding: 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>

    <div id="filter-container">
        <label for="category-filter">é¸æ“‡é¡¯ç¤ºåˆ†é¡:</label>
        <select id="category-filter" onchange="filterMarkers(this.value)">
            <option value="å…¨éƒ¨">å…¨éƒ¨</option>
            <option value="å¤è¹Ÿ">å¤è¹Ÿ</option>
            <option value="åº—å®¶">åº—å®¶</option>
        </select>
    </div>

    <div id="map"></div>

    <script src="data.js"></script>

    <script>


        // *** åˆå§‹åŒ– Google åœ°åœ–å’Œæ¨™è¨˜åŠŸèƒ½ ***

        // å®£å‘Šåœ°åœ–å’Œè³‡è¨Šè¦–çª—è®Šæ•¸
        let map;
        let infoWindow;
        // æ–°å¢ï¼šç”¨ä¾†å„²å­˜æ‰€æœ‰åœ°åœ–æ¨™è¨˜çš„é™£åˆ—
        let markers = [];


        // é€™æ˜¯ Google Maps API è¼‰å…¥å®Œæˆå¾Œæœƒè‡ªå‹•åŸ·è¡Œçš„å‡½å¼
        function initMap() {
            // 1. è¨­å®šé¹¿æ¸¯è€è¡—çš„ä¸­å¿ƒé»ç¶“ç·¯åº¦
            const lukangCenter = { lat: 24.0573, lng: 120.4340 };

            // 2. å»ºç«‹åœ°åœ–ç‰©ä»¶
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 17, // åˆå§‹æ”¾å¤§ç´šæ•¸
                center: lukangCenter, // åˆå§‹ä¸­å¿ƒé»
                mapTypeId: 'roadmap', // åœ°åœ–é¡å‹
            });

            // 3. å»ºç«‹ä¸€å€‹å…±ç”¨çš„è³‡è¨Šè¦–çª—
            infoWindow = new google.maps.InfoWindow();

            // 4. æ ¹æ“šè³‡æ–™é™£åˆ—ï¼Œå‰µå»ºæ‰€æœ‰æ¨™è¨˜
            // ** å‚™è¨»ï¼šæ­¤è™•å‡è¨­ lukangData è®Šæ•¸åœ¨ data.js å·²ç¶“å®šç¾© **
            if (typeof lukangData !== 'undefined' && Array.isArray(lukangData)) {
                lukangData.forEach(data => {
                    addMarker(data);
                });
            } else {
                console.error("éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° lukangData é™£åˆ—ï¼Œè«‹ç¢ºèª data.js æª”æ¡ˆå·²æ­£ç¢ºè¼‰å…¥ä¸¦åŒ…å«è³‡æ–™ã€‚");
            }
        }


// å‰µå»ºæ¨™è¨˜å’Œç¶å®šè³‡è¨Šè¦–çª—çš„å‡½å¼
function addMarker(data) {
    // 1. å‰µå»ºæ¨™è¨˜
    const marker = new google.maps.Marker({
        position: { lat: data.lat, lng: data.lng },
        map: map,
        title: data.name,
        icon: getMarkerIcon(data.category),
        category: data.category
    });

    markers.push(marker);

    // è£½ä½œå°èˆªé€£çµ (Google Maps å¤–éƒ¨é€£çµ)
    const navUrl = `https://www.google.com/maps/dir/?api=1&destination=${data.lat},${data.lng}&travelmode=walking`;

    // è™•ç†åœ–ç‰‡å…§å®¹
    const imageHtml = data.imageUrl ?
        `<img src="${data.imageUrl}" style="width:100%; max-height:150px; object-fit:cover; border-radius:8px; margin-bottom: 10px;">`
        : '';

    // 2. å‰µå»ºè³‡è¨Šè¦–çª—çš„ HTML å…§å®¹ (åŠ å…¥å°èˆªæŒ‰éˆ•)
    const content = `
        <div class="info-window-content">
            ${imageHtml}
            <h4>${data.name} <span style="font-size:12px; color:#666;">(${data.category})</span></h4>
            <p><strong>åœ°å€:</strong> ${data.address}</p>
            <p><strong>æ•…äº‹:</strong> ${data.story}</p>
            <hr>
            <a href="${navUrl}" target="_blank" style="
                display: block;
                background-color: #C0392B;
                color: white;
                text-align: center;
                padding: 10px;
                text-decoration: none;
                border-radius: 5px;
                font-weight: bold;
            ">ğŸ“ é–‹å§‹å°èˆª (æ­¥è¡Œ)</a>
        </div>
    `;

    // 3. ç›£è½é»æ“Š
    marker.addListener("click", () => {
        infoWindow.close();
        infoWindow.setContent(content);
        infoWindow.open({ anchor: marker, map: map });
    });
}

        // æ ¹æ“šåœ°é»é¡å‹çµ¦äºˆä¸åŒçš„åœ–æ¨™ï¼Œè®“åœ°åœ–æ›´ç”Ÿå‹•
        function getMarkerIcon(category) {
            let iconUrl;
            switch (category) {
                case "å¤è¹Ÿ":
                    // è‡ªè¨‚åœ–æ¨™ï¼šä¾‹å¦‚ä¸€å€‹å¯ºå»Ÿæˆ–å±‹é ‚çš„åœ–æ¡ˆ
                    iconUrl = 'dot.png';
                    break;
                case "åº—å®¶":
                    // è‡ªè¨‚åœ–æ¨™ï¼šä¾‹å¦‚ä¸€å€‹é£Ÿç‰©æˆ–é¤å»³çš„åœ–æ¡ˆ
                    iconUrl = 'dot2.png';
                    break;
            }
            return {
                url: iconUrl,
                scaledSize: new google.maps.Size(35, 42) // åœ–æ¨™å¤§å° (å¯èª¿æ•´)
            };
        }

        // *** æ–°å¢ï¼šæ ¹æ“šä½¿ç”¨è€…é¸æ“‡çš„åˆ†é¡ç¯©é¸æ¨™è¨˜çš„å‡½å¼ ***
        function filterMarkers(selectedCategory) {
            // é—œé–‰å¯èƒ½é–‹å•Ÿçš„è³‡è¨Šè¦–çª—
            if (infoWindow) {
                infoWindow.close();
            }

            // è¿´åœˆéæ­·æ‰€æœ‰å·²å‰µå»ºçš„æ¨™è¨˜
            markers.forEach(marker => {
                // æª¢æŸ¥æ¢ä»¶ï¼š
                // 1. å¦‚æœé¸æ“‡çš„æ˜¯ "å…¨éƒ¨" (selectedCategory === 'å…¨éƒ¨')
                // 2. å¦‚æœæ¨™è¨˜çš„åˆ†é¡èˆ‡é¸æ“‡çš„åˆ†é¡ç›¸åŒ (marker.category === selectedCategory)
                const shouldShow = (selectedCategory === 'å…¨éƒ¨' || marker.category === selectedCategory);

                // setMap(map) æœƒé¡¯ç¤ºæ¨™è¨˜ï¼ŒsetMap(null) æœƒéš±è—æ¨™è¨˜
                marker.setMap(shouldShow ? map : null);
            });
        }


        // å°‡ initMap å‡½å¼æš´éœ²çµ¦å…¨åŸŸ window ç‰©ä»¶ (Google API è¼‰å…¥éœ€è¦)
        window.initMap = initMap;
        // ç‚ºäº†è®“ HTML çš„ onchange äº‹ä»¶èƒ½å‘¼å«ï¼Œä¹Ÿå°‡ filterMarkers æš´éœ²å‡ºä¾†
        window.filterMarkers = filterMarkers;
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVIaUxpl9GD5Loo0SpKoIXiC0SsT1DROY&callback=initMap" defer></script>

</body>

</html>
