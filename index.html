<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>( Í¡Â° ÍœÊ– Í¡Â°)å³æŸç¿°æ˜¯æ†¨ä»”!ğŸ¤£ğŸ˜‚à¼¼ ã¤ â—•_â—• à¼½ã¤ğŸ’‹ğŸ“ğŸ’‹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* CSS æ¨£å¼ï¼šè¨­å®šåœ°åœ–é¡¯ç¤ºå€å¡Šçš„å¤§å° */
        #map {
            height: 100vh; /* è®“åœ°åœ–ä½”æ»¿æ•´å€‹è¦–çª—é«˜åº¦ */
            width: 100%;  /* è®“åœ°åœ–ä½”æ»¿æ•´å€‹è¦–çª—å¯¬åº¦ */
        }
        /* è³‡è¨Šè¦–çª—çš„æ¨£å¼èª¿æ•´ï¼Œè®“æ•…äº‹å…§å®¹æ›´æ˜“è®€ */
        .info-window-content {
            max-width: 300px;
            padding: 5px;
        }
        .info-window-content h4 {
            margin-top: 0;
            color: #C0392B; /* é¹¿æ¸¯ç´… */
        }
        .info-window-content p {
            font-size: 14px;
            line-height: 1.5;
        }
        /* è®“é é¢é‚Šè·æ­¸é›¶ */
        body {
            margin: 0;
            padding: 0;
        }
        /* ç¯©é¸é¸å–®çš„æ¨£å¼ï¼Œè®“å®ƒæµ®åœ¨åœ°åœ–ä¸Šæ–¹ */
        #filter-container {
            position: absolute;
            top: 60px;
            left: 10px;
            z-index: 10; /* ç¢ºä¿é¸å–®åœ¨åœ°åœ–ä¹‹ä¸Š */
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 6px rgba(0,0,0,.3);
            font-family: Arial, sans-serif;
            font-size: 15px;
        }
        #category-filter {
            padding: 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>

    <div id="filter-container">
        <label for="category-filter">é¸æ“‡é¡¯ç¤ºåˆ†é¡:</label>
        <select id="category-filter" onchange="filterMarkers(this.value)">
            <option value="å…¨éƒ¨">å…¨éƒ¨</option>
            <option value="å¤è¹Ÿ">å¤è¹Ÿ</option>
            <option value="åº—å®¶">åº—å®¶</option>
        </select>
    </div>

    <div id="map"></div>

    <script src="data.js"></script>

    <script>


        // *** åˆå§‹åŒ– Google åœ°åœ–å’Œæ¨™è¨˜åŠŸèƒ½ ***

        // å®£å‘Šåœ°åœ–å’Œè³‡è¨Šè¦–çª—è®Šæ•¸
        let map;
        let infoWindow;
        // æ–°å¢ï¼šç”¨ä¾†å„²å­˜æ‰€æœ‰åœ°åœ–æ¨™è¨˜çš„é™£åˆ—
        let markers = [];


        // é€™æ˜¯ Google Maps API è¼‰å…¥å®Œæˆå¾Œæœƒè‡ªå‹•åŸ·è¡Œçš„å‡½å¼
        function initMap() {
            // 1. è¨­å®šé¹¿æ¸¯è€è¡—çš„ä¸­å¿ƒé»ç¶“ç·¯åº¦
            const lukangCenter = { lat: 24.0573, lng: 120.4340 };

            // 2. å»ºç«‹åœ°åœ–ç‰©ä»¶
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 17, // åˆå§‹æ”¾å¤§ç´šæ•¸
                center: lukangCenter, // åˆå§‹ä¸­å¿ƒé»
                mapTypeId: 'roadmap', // åœ°åœ–é¡å‹
            });

            // 3. å»ºç«‹ä¸€å€‹å…±ç”¨çš„è³‡è¨Šè¦–çª—
            infoWindow = new google.maps.InfoWindow();

            // 4. æ ¹æ“šè³‡æ–™é™£åˆ—ï¼Œå‰µå»ºæ‰€æœ‰æ¨™è¨˜
            // ** å‚™è¨»ï¼šæ­¤è™•å‡è¨­ lukangData è®Šæ•¸åœ¨ data.js å·²ç¶“å®šç¾© **
            if (typeof lukangData !== 'undefined' && Array.isArray(lukangData)) {
                lukangData.forEach(data => {
                    addMarker(data);
                });
            } else {
                console.error("éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° lukangData é™£åˆ—ï¼Œè«‹ç¢ºèª data.js æª”æ¡ˆå·²æ­£ç¢ºè¼‰å…¥ä¸¦åŒ…å«è³‡æ–™ã€‚");
            }
        }


// å‰µå»ºæ¨™è¨˜å’Œç¶å®šè³‡è¨Šè¦–çª—çš„å‡½å¼
function addMarker(data) {
            // 1. å‰µå»ºæ¨™è¨˜
            const marker = new google.maps.Marker({
                position: { lat: data.lat, lng: data.lng }, // ç¶“ç·¯åº¦
                map: map, // ç¶å®šåˆ°å“ªå€‹åœ°åœ–
                title: data.name, // æ¨™è¨˜çš„æç¤ºæ–‡å­—
                icon: getMarkerIcon(data.category), // æ ¹æ“šé¡åˆ¥è¨­å®šè‡ªè¨‚åœ–æ¨™
                // *** é—œéµæ–°å¢ï¼šå°‡åˆ†é¡è³‡è¨Šä¹Ÿå­˜åˆ°æ¨™è¨˜ç‰©ä»¶ä¸Š ***
                category: data.category
            });

            // *** é—œéµæ–°å¢ï¼šå°‡æ¨™è¨˜å­˜å…¥å…¨åŸŸé™£åˆ— ***
            markers.push(marker);


            // *** æ­¥é©ŸäºŒæ–°å¢ï¼šåˆ¤æ–·æ˜¯å¦æœ‰åœ–ç‰‡ç¶²å€ï¼Œä¸¦ç”Ÿæˆåœ–ç‰‡ HTML ***
            // é€™è£¡ä½¿ç”¨äº†å…§è¯æ¨£å¼ (style="...") ç¢ºä¿åœ–ç‰‡ä¸æœƒè¶…éè³‡è¨Šè¦–çª—çš„å¯¬åº¦
            const imageHtml = data.imageUrl ?
                `<img src="${data.imageUrl}" style="max-width:100%; height:auto; margin-bottom: 10px;" alt="${data.name}">`
                : ''; // å¦‚æœæ²’æœ‰ç¶²å€ï¼Œå‰‡ç‚ºç©ºå­—ä¸²

            // 2. å‰µå»ºè³‡è¨Šè¦–çª—çš„ HTML å…§å®¹
            const content = `
                <div class="info-window-content">
                    ${imageHtml}
                    <h4>${data.name} (${data.category})</h4>
                    <p><strong>åœ°å€:</strong> ${data.address}</p>
                    <p><strong>æ•…äº‹/ä»‹ç´¹:</strong> ${data.story}</p>
                </div>
            `;

            // 3. ç›£è½æ¨™è¨˜çš„é»æ“Šäº‹ä»¶
            marker.addListener("click", () => {
                // é»æ“Šæ¨™è¨˜æ™‚ï¼š
                infoWindow.close();

                // è¨­å®šè³‡è¨Šè¦–çª—çš„å…§å®¹
                infoWindow.setContent(content);

                // é–‹å•Ÿè³‡è¨Šè¦–çª—ä¸¦å°‡å…¶éŒ¨å®šåˆ°ç•¶å‰æ¨™è¨˜
                infoWindow.open({
                    anchor: marker,
                    map: map,
                });
            });
        }

        // æ ¹æ“šåœ°é»é¡å‹çµ¦äºˆä¸åŒçš„åœ–æ¨™ï¼Œè®“åœ°åœ–æ›´ç”Ÿå‹•
        function getMarkerIcon(category) {
            let iconUrl;
            switch (category) {
                case "å¤è¹Ÿ":
                    // è‡ªè¨‚åœ–æ¨™ï¼šä¾‹å¦‚ä¸€å€‹å¯ºå»Ÿæˆ–å±‹é ‚çš„åœ–æ¡ˆ
                    iconUrl = 'dot.png';
                    break;
                case "åº—å®¶":
                    // è‡ªè¨‚åœ–æ¨™ï¼šä¾‹å¦‚ä¸€å€‹é£Ÿç‰©æˆ–é¤å»³çš„åœ–æ¡ˆ
                    iconUrl = 'dot2.png';
                    break;
            }
            return {
                url: iconUrl,
                scaledSize: new google.maps.Size(35, 42) // åœ–æ¨™å¤§å° (å¯èª¿æ•´)
            };
        }

        // *** æ–°å¢ï¼šæ ¹æ“šä½¿ç”¨è€…é¸æ“‡çš„åˆ†é¡ç¯©é¸æ¨™è¨˜çš„å‡½å¼ ***
        function filterMarkers(selectedCategory) {
            // é—œé–‰å¯èƒ½é–‹å•Ÿçš„è³‡è¨Šè¦–çª—
            if (infoWindow) {
                infoWindow.close();
            }

            // è¿´åœˆéæ­·æ‰€æœ‰å·²å‰µå»ºçš„æ¨™è¨˜
            markers.forEach(marker => {
                // æª¢æŸ¥æ¢ä»¶ï¼š
                // 1. å¦‚æœé¸æ“‡çš„æ˜¯ "å…¨éƒ¨" (selectedCategory === 'å…¨éƒ¨')
                // 2. å¦‚æœæ¨™è¨˜çš„åˆ†é¡èˆ‡é¸æ“‡çš„åˆ†é¡ç›¸åŒ (marker.category === selectedCategory)
                const shouldShow = (selectedCategory === 'å…¨éƒ¨' || marker.category === selectedCategory);

                // setMap(map) æœƒé¡¯ç¤ºæ¨™è¨˜ï¼ŒsetMap(null) æœƒéš±è—æ¨™è¨˜
                marker.setMap(shouldShow ? map : null);
            });
        }


        // å°‡ initMap å‡½å¼æš´éœ²çµ¦å…¨åŸŸ window ç‰©ä»¶ (Google API è¼‰å…¥éœ€è¦)
        window.initMap = initMap;
        // ç‚ºäº†è®“ HTML çš„ onchange äº‹ä»¶èƒ½å‘¼å«ï¼Œä¹Ÿå°‡ filterMarkers æš´éœ²å‡ºä¾†
        window.filterMarkers = filterMarkers;
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVIaUxpl9GD5Loo0SpKoIXiC0SsT1DROY&callback=initMap" defer></script>

</body>
</html>